#!/usr/bin/env bash
msg_file="$1"
pattern='^(revert: )?(feat|fix|docs|style|refactor|perf|test|build|ci|chore|ops|sec)(\(.+\))?: .+'
 
# Allow merge commits (auto-generated messages like "Merge branch ...")
# Detect an in-progress merge via MERGE_HEAD; if present, skip validation.
if git rev-parse -q --verify MERGE_HEAD >/dev/null 2>&1; then
  exit 0
fi

if ! grep -Eq "$pattern" "$msg_file"; then
  echo "âœ– Commit message must follow Conventional Commits" >&2
  exit 1
fi
