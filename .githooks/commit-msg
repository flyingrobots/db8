#!/usr/bin/env bash
msg_file="$1"
pattern='^(revert: )?(feat|fix|docs|style|refactor|perf|test|build|ci|chore|ops|sec)(\(.+\))?: .+'
merge_pattern='^Merge (branch|pull request|remote-tracking branch)'

# Allow merge commits (auto-generated messages like "Merge branch ...")
# by checking the message content rather than repository state.
if grep -Eq "$merge_pattern" "$msg_file"; then
  exit 0
fi

if ! grep -Eq "$pattern" "$msg_file"; then
  echo "âœ– Commit message must follow Conventional Commits" >&2
  exit 1
fi
