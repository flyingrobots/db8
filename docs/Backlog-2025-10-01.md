# Backlog Sync — 2025-10-01

This file mirrors the proposed resequenced plan. Use the `gh` CLI commands to create issues and attach them to the "db8 Roadmap" project with correct labels and milestones.

Prereqs:

- `gh auth login`
- Milestones M1–M7 exist; labels `area/*`, `type/*`, `priority/*`, `status/*` exist.

## Tasks

### 1) Decide realtime source of truth (SSE canonical)

- Milestone: M1
- Labels: area/server, type/design, priority/P0
- Acceptance:
  - ADR or short DESIGN note declares SSE + LISTEN/NOTIFY as canonical; Supabase Realtime optional.
  - Docs updated (Architecture.md, GettingStarted.md).

```
gh issue create \
  --title "ADR: SSE (DB LISTEN/NOTIFY) as canonical realtime path" \
  --body "Declare SSE canonical; update docs; Supabase RT optional mirror." \
  --label area/server --label type/design --label priority/P0 --milestone M1
```

### 2) Implement watcher loop (authoritative flips)

- Milestone: M1
- Labels: area/worker, type/feat, priority/P1
- Depends on: #1
- Acceptance: watcher calls `round_publish_due()`/`round_open_next()` on schedule; /events emits phase on DB NOTIFY; DB tests prove flips.

```
gh issue create \
  --title "feat(worker): authoritative watcher invokes round flips" \
  --body "Implement loop calling round_publish_due/open_next; add DB-backed tests; ensure /events emits phase on flip." \
  --label area/worker --label type/feat --label priority/P1 --milestone M1
```

### 3) Enforce RLS + secure views

- Milestone: M1
- Labels: area/db, type/security, priority/P0
- Acceptance: RLS enabled; secure views; pgTAP + Vitest prove pre/post-publish visibility.

```
gh issue create \
  --title "security(db): enable RLS and secure read views" \
  --body "Policies for submissions/votes/participants/rounds; tests for visibility before/after publish." \
  --label area/db --label type/security --label priority/P0 --milestone M1
```

### 4) Schema/contract alignment (phase enums)

- Milestone: M1
- Labels: area/server, area/cli, area/web, type/chore, priority/P1
- Acceptance: unified phase enum or adapter; tests pass; docs updated.

```
gh issue create \
  --title "chore: unify phase enums across DB/Server/CLI/Web" \
  --body "Align to submit|published|final; update Zod & tests; document mapping if needed." \
  --label area/server --label area/cli --label area/web --label type/chore --label priority/P1 --milestone M1
```

### 5) JCS canonicalization (RFC 8785)

- Milestone: M2
- Labels: area/server, area/cli, type/feat, priority/P0

```
gh issue create \
  --title "feat(provenance): adopt RFC 8785 JCS canonicalization" \
  --body "Implement JCS in server/CLI; add vector tests; ensure DB invariants on canonical_sha256." \
  --label area/server --label area/cli --label type/feat --label priority/P0 --milestone M2
```

### 6) Server-generated submission nonces

- Milestone: M2
- Labels: area/server, area/db, type/feat, priority/P0

```
gh issue create \
  --title "feat(security): server-issued submission nonces (issue + enforce)" \
  --body "Add nonce endpoint/table; enforce single-use; return 409 on invalid; tests + pgTAP." \
  --label area/server --label area/db --label type/feat --label priority/P0 --milestone M2
```

### 7) SSH/Ed25519 provenance + challenge/verify

- Milestone: M2
- Labels: area/server, area/cli, type/feat, priority/P0

```
gh issue create \
  --title "feat(provenance): SSH/Ed25519 signature verification + challenge" \
  --body "Implement /auth/challenge & /auth/verify; ssh-keygen -Y verify; CLI --sign; tests." \
  --label area/server --label area/cli --label type/feat --label priority/P0 --milestone M2
```

### 8) Server checkpoint signature + journals + CLI verify

- Milestone: M2
- Labels: area/worker, area/server, area/cli, type/feat, priority/P1

```
gh issue create \
  --title "feat(journal): round chain hash + server signature + CLI verify" \
  --body "Write per-round journal; serve via /journal; implement CLI verify; add deterministic tests." \
  --label area/worker --label area/server --label area/cli --label type/feat --label priority/P1 --milestone M2
```

### 9) Fact-check & verify phase

- Milestone: M3
- Labels: area/web, area/server, area/db, type/feat, priority/P1

```
gh issue create \
  --title "feat(verify): per-claim verdicts + moderator workflows" \
  --body "Tables/RPCs/UI; realtime updates; /state integration; tests." \
  --label area/web --label area/server --label area/db --label type/feat --label priority/P1 --milestone M3
```

### 10) Ops/CI: pgTAP expansion + required checks

- Milestone: M7
- Labels: area/ci, type/chore, priority/P1

```
gh issue create \
  --title "chore(ci): expand pgTAP for RLS, triggers, nonces; document required checks" \
  --body "Add pgTAP for new invariants; workflow toggle; ensure Ruleset check names match." \
  --label area/ci --label type/chore --label priority/P1 --milestone M7
```
